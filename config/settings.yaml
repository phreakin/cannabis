# Cannabis Data Aggregator - Global Settings
# These settings can be overridden by environment variables

app:
  name: "Cannabis Data Aggregator"
  version: "1.0.0"
  description: "Aggregate cannabis open data from US state and federal sources"
  host: "0.0.0.0"
  port: 5000
  debug: false
  secret_key: "${FLASK_SECRET_KEY}"
  timezone: "America/Phoenix"

# Admin dashboard credentials (overridden by env vars)
admin:
  username: "${ADMIN_USERNAME:admin}"
  password: "${ADMIN_PASSWORD:Passw0rd}"
  email: "${ADMIN_EMAIL:phreakin@gmail.com}"

database:
  url: "${DATABASE_URL:sqlite:///data/cannabis_aggregator.db}"
  pool_size: 10
  pool_timeout: 30
  echo: false  # Set true to log all SQL queries

# Data collection settings
collection:
  timeout: 60            # HTTP request timeout in seconds
  page_size: 5000        # Default records per paginated request
  max_retries: 3         # Max retries on failed requests
  retry_delay: 5         # Seconds between retries
  max_concurrent: 5      # Max concurrent collection jobs
  user_agent: "CannabisDataAggregator/1.0 (Open Data Collector; +https://github.com/phreakin/)"

# Rate limiting defaults (per source, overridden per source in sources.yaml)
rate_limiting:
  default_requests_per_minute: 60
  default_requests_per_hour: 1000
  burst_allowance: 10

# Storage paths
storage:
  raw_data_dir: "data/raw"
  processed_data_dir: "data/processed"
  export_dir: "data/exports"
  log_dir: "logs"
  max_raw_file_mb: 500
  archive_after_days: 90  # Archive raw files older than N days
  retain_raw_days: 365    # Delete raw files older than N days

# Scheduler settings
scheduler:
  enabled: true
  timezone: "America/Phoenix"
  misfire_grace_secs: 3600  # How late a job can fire
  coalesce: true            # Combine missed runs into one
  max_instances: 3          # Max concurrent instances per job
  job_store: "sqlalchemy"   # sqlalchemy or memory

# Logging configuration
logging:
  level: "INFO"              # DEBUG, INFO, WARNING, ERROR
  format: "%(asctime)s [%(levelname)s] %(name)s: %(message)s"
  date_format: "%m-%d-%Y %H:%M:%S"
  console: true
  file: true
  file_path: "logs/app.log"
  max_bytes: 10485760        # 10MB
  backup_count: 5

# Normalization settings
normalization:
  # Standard category names
  categories:
    - dispensaries
    - cultivators
    - processors
    - manufacturers
    - transporters
    - distributors
    - labs
    - medical_providers
    - licenses
    - sales
    - products
    - brands
    - laws
    - violations
    - lab_results
    - seed_to_sale

  # Standard US state codes
  valid_states:
    - AL: Alabama
    - AK: Alaska
    - AZ: Arizona
    - AR: Arkansas
    - CA: California
    - CO: Colorado
    - CT: Connecticut
    - DE: Delaware
    - FL: Florida
    - GA: Georgia
    - HI: Hawaii
    - ID: Idaho
    - IL: Illinois
    - IN: Indiana
    - IA: Iowa
    - KS: Kansas
    - KY: Kentucky
    - LA: Louisiana
    - ME: Maine
    - MD: Maryland
    - MA: Massachusetts
    - MI: Michigan
    - MN: Minnesota
    - MS: Mississippi
    - MO: Missouri
    - MT: Montana
    - NE: Nebraska
    - NV: Nevada
    - NH: New Hampshire
    - NJ: New Jersey
    - NM: New Mexico
    - NY: New York
    - NC: North Carolina
    - ND: North Dakota
    - OH: Ohio
    - OK: Oklahoma
    - OR: Oregon
    - PA: Pennsylvania
    - RI: Rhode Island
    - SC: South Carolina
    - SD: South Dakota
    - TN: Tennessee
    - TX: Texas
    - UT: Utah
    - VT: Vermont
    - VA: Virginia
    - WA: Washington
    - WV: West Virginia
    - WI: Wisconsin
    - WY: Wyoming
    - DC: Washington DC
    - FEDERAL: Federal

# Export formats
export:
  formats:
    - csv
    - json
    - geojson
    - xlsx
  default_format: csv
  max_records_per_file: 100000

# Geocoding (optional - for filling in missing coordinates)
geocoding:
  enabled: true
  provider: "nominatim"     # nominatim (free) or google (requires key)
  nominatim_url: "https://nominatim.openstreetmap.org"
  google_api_key: "${GOOGLE_MAPS_API_KEY}"
  rate_limit: 1             # Max requests per second (Nominatim is 1/s)
  cache: true

# Notifications
notifications:
  enabled: true
  on_failure: true
  on_success: false
  email:
    enabled: false
    smtp_host: "${SMTP_HOST}"
    smtp_port: 587
    smtp_user: "${SMTP_USER}"
    smtp_password: "${SMTP_PASSWORD}"
    from_email: "noreply@cannabis-aggregator.local"
    to_emails:
      - "${NOTIFY_EMAIL}"
  slack:
    enabled: false
    webhook_url: "${SLACK_WEBHOOK_URL}"
